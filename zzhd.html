<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
        <meta http-equiv="page-Enter" content="revealTrans(Duration=3.0,Transition=23)">
		<link rel="stylesheet" type="text/css" href="lib/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
		<link rel="stylesheet" type="text/css" href="lib/font-awesome/css/font-awesome.css"/>
		<script src="lib/jquery/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/setCookie.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/ajax.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="lib/layui/layui.js" type="text/javascript" charset="utf-8"></script>
		<title>组织活动</title>
	</head>
	<body>
		<script src="js/nav.js" type="text/javascript" charset="utf-8"></script>
		<div class="mainBody" id="app" v-cloak>
			<!-- 标题 -->
			<div class="flagTit">
				<div class="flagTitIcon">组织活动</div>
				<div class="backBtn" onclick="window.history.back(-1)">
					<img src="statics/images/back_btn.png" >
					<span>返回</span>
				</div>
			</div>
			<!-- 搜索框 -->
			<div class="searchBox">
				<div>
					<div>活动名称：</div>
					<div class="search">
						<input type="text" v-model="searchbox" name="" id="search" value=""  placeholder="输入查询"/>
						<i @click="search" class="fa fa-search" aria-hidden="true"></i>
					</div>
				</div>
				<div class="layui-form">
					<div>年份：</div>
					<div class="search">
						<div class="layui-form-item">
						    <div class="layui-input-block">
						      <select name="city" lay-verify="required" lay-filter="year">
						        <option value=""></option>
						        <option value="2021">2021</option>
						        <option value="2020">2020</option>
						        <option value="2019">2019</option>
						        <option value="2018">2018</option>
						        <option value="2017">2017</option>
						      </select>
						    </div>
						  </div>
					</div>
				</div>
				<div class="layui-form">
					<div>月份：</div>
					<div class="search">
						<div class="layui-form-item">
						    <div class="layui-input-block">
						      <select name="city" lay-verify="required" lay-filter="month">
						        <option value=""></option>
						        <option value="1">1月</option>
						        <option value="2">2月</option>
						        <option value="3">3月</option>
						        <option value="4">4月</option>
						        <option value="5">5月</option>
						        <option value="6">6月</option>
						        <option value="7">7月</option>
						        <option value="8">8月</option>
						        <option value="9">9月</option>
						        <option value="10">10月</option>
						        <option value="11">11月</option>
						        <option value="12">12月</option>
						      </select>
						    </div>
						  </div>
					</div>
				</div>
				<div class="layui-form">
					<div>活动类型：</div>
					<div class="search">
						<div class="layui-form-item">
						    <div class="layui-input-block">
						      <select name="city" lay-verify="required"  lay-filter="acttype">
						        <option value=""></option>
						        <option value="1">支部委员大会</option>
						        <option value="2">支部党员大会</option>
						        <option value="3">支部党小组会</option>
						        <option value="4">党课</option>
						        <option value="5">主题党日</option>
						        <option value="6">组织生活会</option>
						        <option value="8">民主生活会</option>
						        <option value="9">谈心谈话</option>
						        <option value="10">民主评议党员会</option>
						        <option value="7">其他</option>
						      </select>
						    </div>
						  </div>
					</div>
				</div>
				<div class="layui-form">
					<div>活动状态：</div>
					<div class="search">
						<div class="layui-form-item">
						    <div class="layui-input-block">
						      <select name="city" lay-verify="required" lay-filter="istart">
						        <option value=""></option>
						        <option value="1">未开始</option>
						        <option value="2">已完成</option>
						      </select>
						    </div>
						  </div>
					</div>
				</div>
			</div>
			<!-- 内容列表 -->
			<div class="contList" id="appWrap">
				<!-- 此处循环 -->
				<div>
					<div class="contListItem" v-for="item in dataList">
						<div class="topImg">
							<img v-if="item.img!=null && item.img!=''" :src="item.img" >
						</div>
						<div class="bottomWords">
							<div class="bbTit">{{item.title}}</div>
							<div class="bbType">{{item.type}}</div>
							<div class="bbTime">{{item.k_time}}</div>
							<div class="bbDetail">{{item.address}}</div>
							<div class="bbbtn">
								<div v-if="item.istart == 1" @click="goActive(item.id,item.focus)">开始活动</div>
								<div class="showDetial"  @click="goActive(item.id,item.focus)">详情</div>
							</div>
						</div>
					</div>
					<div class="null" v-show="dataList.length == 0">暂无数据</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			window.onload = function(){
				var app = new Vue({
					el:"#app",
					data:{
						step:1,
						// 个体数据传参
						get:{
							page:1,
							user_id: user.id,
							flag:user.flag,
							title:"", 
							year:"",
							month:"",
							type:"",
							istart:"",
							focus:""
						},
						// 数据循环
						dataList:[],
						// 导航条分类筛选
						fenleiSelect:0,
						// 文字搜索
						searchbox:"",
						// 滚动加载
						onFetching:false,
						page:1,
						total:1
					},
					methods:{
						importClass(){
							var that = this;
							// 重点党课列表
							postData("activity",that.get,function(res){
								if(res.code == 200){
									if(res.data.pagedata != null){
										for(var i=0;i<res.data.pagedata.length;i++){
											res.data.pagedata[i].h_stime = toNumber(res.data.pagedata[i].h_stime);
											if(res.data.pagedata[i].img!= null && res.data.pagedata[i].img!= ""){
												if(res.data.pagedata[i].img.search("http") == -1){
													res.data.pagedata[i].img = 'http://'+res.data.pagedata[i].ym+'/'+res.data.pagedata[i].img;
												}
											}
											that.dataList.push(res.data.pagedata[i]);
										}
										that.total = res.data.total;
									}else{
										that.dataList = [];
									}
								}
							})
						},
						// 搜索
						search(){
							var that = this;
							that.dataList = [];
							that.get.title = that.searchbox;
							that.get.page = 1;
							that.page = 1;
							that.total = 0;
							that.importClass();
						},
						scroll(){
							var that = this;
							var scroll = document.getElementById('appWrap');
							scroll.onscroll = function(){
							    var t = scroll.scrollTop;  //离上方du的距zhi离
							    var h =scroll.innerHeight || scroll.clientHeight || scroll.clientHeight; //可见dao宽度
							    if( t >= scroll.scrollHeight -h ) {
									that.page++;
									if(that.page == that.total+1){
										that.page = that.total
									}else{
										if(that.page <= that.total){
											that.get.page = that.page
											that.importClass()
										}
									}
							    }
							}
						},
						// 开始活动
						goActive(id,focus){
							var that = this;
							window.location.href = 'zzhd_detail.html?id='+id;
						}
					},
					mounted() {
						var that = this;
						that.scroll();
						// 初始化layui框架
						layui.use(['layer','form'],function(){
							var layer = layui.layer;
							var form = layui.form;
							// 状态筛选
							form.on('select(istart)', function (data) {
								that.get.istart = data.value;
								that.dataList = [];
								that.get.page = 1;
								that.page = 1;
								that.total = 0;
								that.importClass();
							});
							// 年份筛选
							form.on('select(year)', function (data) {
								that.get.year = data.value;
								that.dataList = [];
								that.get.page = 1;
								that.page = 1;
								that.total = 0;
								that.importClass();
							});
							// 月份筛选
							form.on('select(month)', function (data) {
								that.get.month = data.value;
								that.dataList = [];
								that.get.page = 1;
								that.page = 1;
								that.total = 0;
								that.importClass();
							});
							// 活动类型筛选
							form.on('select(acttype)', function (data) {
								that.get.type = data.value;
								that.dataList = [];
								that.get.page = 1;
								that.page = 1;
								that.total = 0;
								that.importClass();
							});
						})
					},
					created() {
						var that = this;
						that.importClass();
						// 回车键搜索
						$(document).keydown(function(event){
							if(event.keyCode == 13){			
								that.dataList = [];
								that.get.page = 1;
								that.page = 1;
								that.total = 0;
								that.get.title = that.searchbox;
								that.importClass();
							}
						})
					}
				})
			}
		</script>
	</body>
</html>
