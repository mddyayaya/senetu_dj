<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
        <meta http-equiv="page-Enter" content="revealTrans(Duration=3.0,Transition=23)">
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
		<link rel="stylesheet" type="text/css" href="lib/font-awesome/css/font-awesome.css"/>
		<link rel="stylesheet" type="text/css" href="lib/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="statics/lib-master/theme-chalk/index.css"/>
		<script src="lib/jquery/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/setCookie.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/ajax.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/elementui.js" type="text/javascript" charset="utf-8"></script>
		<script src="lib/layui/layui.js" type="text/javascript" charset="utf-8"></script>
		<title>通知公告</title>
		<style type="text/css">
			.searchBox{
				display: flex;
				justify-content: space-between;
			}
			#appWrap{
				padding-bottom: 0 !important;
				height: 70vh !important;
			}
			.contList1>div{
				position: relative;
				margin-top: 2vh;
				width: 100%;
				height: 67vh;
				padding: 2vh 2vh;
				box-sizing: border-box;
				background: #fff;
			}
			.page{
				width: 100%;
				margin-top: 2vh;
				text-align: right;
				position: absolute;
				bottom: 2vh;
				right: 2vh;
			}
			.el-table{
				max-height: 57vh !important;
				overflow-y: scroll;
				overflow-x: hidden;
			}
			.detail_title{
				width: 100%;
				font-size: 2.2vh;
				font-weight: bold;
				line-height: 8vh;
				color: #1E2129;
				text-align: center;
				border-bottom: 0.1vh solid #DC030C;
			}
			.detail_content{
				width: 100%;
				height: 70vh;
				padding: 0 1vw;
				overflow-y: scroll;
				line-height: 3vh;
				font-size: 1.8vh;
				overflow-x: hidden;
				box-sizing: border-box;
			}
			.el-dialog{
				margin-top: 3vh !important;
			}
			.detail_header{
				font-size: 1.5vh;
				text-align: center;
				margin-bottom: 2vh;
			}
		</style>
	</head>
	<body>
		<script src="js/nav.js" type="text/javascript" charset="utf-8"></script>
		<div class="mainBody" id="app" v-cloak>
			<!-- 标题 -->
			<div class="flagTit">
				<div class="flagTitIcon">通知公告</div>
				<div class="backBtn" onclick="window.location.href = 'app.html'">
					<img src="statics/images/back_btn.png" >
					<span>返回</span>
				</div>
			</div>
			<!-- 搜索框 -->
			<div class="searchBox">
				<div id="">
					<div class="fenlei" :class="{fenleiSelect:fenleiSelect==2}" @click="selectType(2)">我发布的</div>					
					<div style="font-size: 2vh !important;" 
						class="fenlei" v-if="get.flag != 1" :class="{fenleiSelect:fenleiSelect==1}" @click="selectType(1)" v-if="get.user_id == 1 || get.user_id == 2"
					>上级通知</div>
				</div>
			</div>
			<!-- 内容列表 -->
			<div class="contList1" id="appWrap">
				<div>
					<el-table
						:header-cell-style="{background:'#f5f7fa',color:'#000'}"
						:data="tableData"
						stripe
						style="width: 100%">
						<el-table-column
							prop="title"
							label="通知">
						</el-table-column>
						<el-table-column
							v-if="fenleiSelect == 1"
							prop="pub_user"
							label="发布组织">
						</el-table-column>
						<el-table-column
							prop=""
							label="时间"
							width="180">
							<template slot-scope="scope">
								{{changeTime(scope.row.addtime)}}
							</template>
						</el-table-column>
						<el-table-column
							prop="address"
							label="操作"
							width="180">
							<template slot-scope="scope">
								<el-button @click="showDetail(scope.row)" type="text" size="small">查看</el-button>
							</template>
						</el-table-column>
					</el-table>
					<!-- 分页 -->
					<div class="page">
						<el-pagination
							:hide-on-single-page="true"
							@current-change="handleCurrentChange"
							background
							:page-size="pageSize"
							layout="prev, pager, next, jumper"
							:total="totalPage">
						</el-pagination>
					</div>
				</div>
			</div>
			<!-- 详情弹窗 -->
			<el-dialog
				title=""
				:visible.sync="dialogVisible"
				width="60%"
				:before-close="handleClose">
				<div slot="title" class="detail_title">
					{{detail.title}}
				</div>
				<div class="detail_content">
					<div class="detail_header">
						<span>发布党组织：{{detail.dw}}</span>
						<span>发布时间：{{detail.time}}</span>
					</div>
					<div v-html="detail.content"></div>
				</div>
			</el-dialog>
		</div>
		<script type="text/javascript">
			window.onload = function(){
				var app = new Vue({
					el:"#app",
					data:{
						step:1,
						// 个体数据传参
						get:{
							page:1,
							type:1, //下级1我的2
							title:"",
							flag:user.flag,
							user_id:user.id
						},
						total:1,
						// 数据循环
						tableData:[],
						// 导航条分类筛选
						fenleiSelect:2,
						// 文字搜索
						searchbox:"",
						pageSize:10, //一页10条
						totalPage:0,//总页数
						dialogVisible:false,
						detail:{}
					},
					methods:{
						// 获取数据
						getdata(){
							var that = this;
							postData("noticeList",that.get,function(res){
								if(res.code == 200){
									if(res.data.pagedata.length != 0){
										that.tableData = res.data.pagedata;
										that.totalPage = res.data.count;
									}else{
										that.tableData = []
									}
								}
							})
						},
						selectType(index){
							var that = this;
							that.fenleiSelect = index;
							that.get.type = index;
							that.getdata();
						},
						// 搜索
						search(){
							var that = this;
							that.page = 1;
							that.total = 1;
							that.get.title = that.searchbox;
						},
						// 查看详情
						showDetail(data){
							// 活动通知
							var that = this;
							that.dialogVisible = true;
							postData("noticeDetail",{
								id:data.tid
							},function(res){
								if(res.code == 200){
									that.$set(that.detail,'title',res.data.title);
									that.$set(that.detail,'dw',res.data.pub_user);
									that.$set(that.detail,'time',that.changeTime(res.data.addtime));
									that.$set(that.detail,'content',res.data.content);
								}
							})
						},
						// 关闭弹窗
						handleClose(){
							var that = this;
							that.dialogVisible = false;
							that.detail = {};
						},
						changeTime(time) {
							if(time != 0 && time != null && time != ''){
								var date = new Date(parseInt(time) * 1000),
								year = date.getFullYear(),
								month = (date.getMonth() + 1) < 10 ? '0'+(date.getMonth() + 1):(date.getMonth() + 1),
								day = date.getDate() < 10 ? '0'+date.getDate():date.getDate();
								return time = year + '-' +month + '-' + day;
							}else{
								time = "暂无数据"
							}
							return time;
						},
						// 分页筛选
						handleCurrentChange(current){
							var that = this;
							that.get.page = current;
						}
					},
					mounted() {
						var that = this;
						that.selectType(that.fenleiSelect)
					},
					created() {
						var that = this;
						$('.topNavBar1 .topNavItem').eq(1).addClass("topNavselect").siblings().removeClass('topNavselect');
						// 回车键搜索
						$(document).keydown(function(event){
							if(event.keyCode == 13){
								that.get.title = that.searchbox;
							}
						})
					}
				})
			}
		</script>
	</body>
</html>
